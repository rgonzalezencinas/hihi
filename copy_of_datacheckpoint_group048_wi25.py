# -*- coding: utf-8 -*-
"""Copy of DataCheckpoint_Group048_WI25.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1rUbDW_SE49NHtMUXed_97GqN0DbnYGO1

**If you lost points on the last checkpoint you can get them back by responding to TA/IA feedback**  

*Update/change the relevant sections* where you lost those points, make sure you respond on GitHub Issues to your TA/IA to call their attention to the changes you made here.

Please *update your Timeline*... no battle plan survives contact with the enemy, so make sure we understand how your plans have changed.

# COGS 108 - Data Checkpoint
"""

# Convert 'Death Date' column to datetime format
df['Death Date'] = pd.to_datpdime(df['Death Date'], errors='coerce')

# Fill missing values in city columns with 'Unknown'
df['Eventdf_overdoseity'].fillna('Unknown', inplace=True)
df['Deathdf_overdoseity'].fillna('Unknown', inplace=True)
df['Res Cdf_overdoseity'].fillna('Unknown', inplace=True)

# Standardize 'Opioid Related' column (Ensure uniform case and remove inconsistencies)
df['Opioidf_overdoseRelated'] = df['Opioidf_overdose Related'].str.strip().str.lower()

# Check unique values in 'Opioid Related' column
opioid_values = df['Opioidf_overdoseRelated'].unique()

# Display cleaned data summary
df.info()df_overdoseopioid_valuesdf_overdose

"""# Names

- Victor Perez-Vela
- Gloria Lee
- Neal Cha
- Rosa Gonzalez Encinas
- Samantha Ramos

# Research Question
## Do mexican cartels meet the legal criteria for foreign terrorist organization designation?

Question: How would the potential correlation between fatal fentanyl overdoses in San Diego and Imperial Counties and cartel-related homicides in the adjacent Mexican municipalities of Tijuana and Mexicali between 2019-2024 impact cartel’s classification of a Foreign Terrorist Organization (FTO) based off the U.S. Department of State’s legal defintion?

## Background and Prior Work

The prevalent and ongoing concern of cartel violence and its impact on U.S. nationals as well as Mexican citizens has become a focal point of concern through the years. The trafficking of fentanyl, a synthetic opioid, has prompted the hypothesis of researching the correlation of drug overdoses with cartel-related activity. Our project aims to explore this correlation between fatal fentanyl overdoses in San Diego and Imperial Counties and cartel-related homicides in neighboring Mexican municipalities, specifically Tijuana and Mexicali, between 2019 and 2024 due to high cartel-related activity during this time period. The spike in fentanyl trafficking between Southern California regions with Mexico bordering cities has shown this rise in drug overdoses1.

Mexican cartels are known to lead the drug trade realm of smuggling and trafficking across borders as well as engaging in violence within the U.S. Research suggests the dynamics between these regions and its intersection, but we aim to gap the bridge of understanding the correlation between fentanyl-related activities and cartel-related homicides, as well as the potential implications for categorizing cartels as Foreign Terrorist Organzations (FTOs). The growing influence of cartels in Mexico and the involvement in criminal activities, implicates the notion of placing danger and harm to the public in a transnational viewpoint. Through a study conducted by Bunker and Sullivan (2005), it is notably presented that Mexican cartel drug wars are increasingly violent, in ways that are brutal to the public.2 This in itself reveals regional instability, strengthening the foundation for reasoning behind the linkage between fentanyl overdoses and cartel homicides.

Additionally, the vast similarities within categorized terrorist groups with cartels is grounds for exploring what exactly labels Foreign Terrorist Organizations (FTOs) as such. The projected reports that contain variables with information about drug trafficking, violence, and cross-bordering activity are going to be analyzed in order for us to proceed with the research question. Through this framework, our project will evaluate whether the cartel-related violence and drug trafficking activities in the U.S.-Mexico border regions fulfill the legal requirements for FTO designation.3


References:
^1 HSI San Diego Welcomes California DOJ Multiagency Task Force to Target Fentanyl. U.S. Immigration and Customs Enforcement (ICE).

^2 Drug Trafficking and Social Dynamics in Mexico, HAL-SHS.

^3 8 U.S. Code § 1189 - Designation of Foreign Terrorist Organizations. House of Representatives, U.S. Government Publishing Office.

# Hypothesis

Hypothesis: We hypothesize that Mexican Cartels meet the legal definition of terrorist organizations as outlined by the U.S. Department of State. This is based on a potential correlation between the rise in fentanyl-related overdoses in Southern California and the increasing cartel-related violence (Mexican Fatalities) in Northern Mexico. This pattern suggests that Mexican Cartels may pose a significant threat to U.S. nationals, potentially fulfilling the criteria for designation as a terrorist entity.

# Ethics & privacy

*   The ethical considerations for this project, which analyzes cartel-related violence and fentanyl overdoses, prioritize data privacy, fairness, and transparency throughout the research process. One significant concern is the potential underreporting or inaccurate reporting in regions heavily influenced by cartels, which could result in biased datasets that do not fully represent the scale of cartel violence. To mitigate this, we will cross-check the data using multiple sources, including alternative datasets like hospital records, to verify accuracy. We will also pay close attention to potential regional or socio-economic biases that may affect the completeness and fairness of the data, ensuring our analysis reflects a broad and representative view of the issue.

* Alongside addressing data biases, privacy concerns are also critical. Given the sensitive nature of homicide and overdoses, there's a risk of inadvertently violating the privacy of individuals, especially victims and their families. To minimize this risk, we will rely on publicly available data from official government reports, which reduces the need for personally identifiable information (PII) and negates the need for informed consent. Transparency is another key ethical principle, and we will ensure the limitations of the data and the findings are clearly communicated, acknowledging uncertainties in the analysis to avoid overstating the scope or impact of cartel activities. This approach will help us maintain ethical standards while conducting the research responsibly.

# Data

Our ideal dataset would focus on the correlation between fatal fentanyl overdoses in San Diego and Imperial Counties and cartel-related homicides in adjacent Mexican municipalities, specifically examining geographical and temporal patterns of cross-border criminal activity between 2019 and 2024. We would measure variables such as the number of fentanyl-related fatalities, broken down by age, gender, ethnicity, and location, along with toxicology reports confirming fentanyl presence. For cartel-related homicides, we would collect data on the number of homicides involving cartel activity, including torture or cartel-specific tagging, as well as the date, time, location, and type of cartel responsible. The dataset would also explore potential biases in law enforcement, media, and government reports, comparing the reliability of data sources. Our ideal data would come from trusted sources, including U.S. public health records from the CDC, local coroner offices, and Mexican government homicide records from SEMEFO, supplemented by NGO and news reports. The time period of 2019-2024 is critical to capture the rise in fentanyl-related deaths and the corresponding increase in cartel violence because it involves recent data. Geographical mapping of the data would help us assess spatial correlations, and analyzing the temporal trends would provide insights into potential spikes in criminal activity. While ideal datasets would include comprehensive and accurate data across these variables, real datasets may have limitations, such as incomplete or inconsistent reporting, particularly in cross-border data or cases involving cartel violence, where underreporting or misclassification may occur. Therefore, part of the project will involve evaluating these discrepancies and biases in the available data, comparing U.S. and Mexican sources, and determining how these differences might affect the analysis of cartel activities and the potential classification of cartels as Foreign Terrorist Organizations (FTOs).

## Data overview
- Dataset #1 (Cartels Related Data)
  - Dataset Name: metadata-conflict-data-for-mexico
  - Link to the dataset: https://data.humdata.org/dataset/79be7c54-3b7b-464a-a8b1-f99eef59cf63/resource/ebc792e7-c425-4d60-9425-3f90ebd5ac24/download/conflict_data_mex.csv
  - Number of observations: 18958
  - Number of variables: 50


- Dataset #2 (Nationwide_Drugs) <span style="color: red;">[To do].</span>
  - Dataset Name:
  - Link to the dataset:
  - Number of observations:
  - Number of variables:
- etc

- Dataset #3 (Overdose Related Data) <span style="color: red;">[To do].</span>
  - Dataset Name:
  - Link to the dataset:
  - Number of observations:
  - Number of variables:
- etc


Dataset #1 (metadata-conflict-data-for-mexico) has individual events of organized violence (phenomena of lethal violence occurring at a given time and place) in mexico including descriptions of place, time, organizations involved, etc.

Dataset #2 <span style="color: red;">[To do: write 2 - 5 sentences describing each dataset here.].</span>

Dataset #3 <span style="color: red;">[To do: Now write 2 - 5 sentences describing each dataset here.].</span>

Note: Include information about how you would need to wrangle/clean/preprocess the dataset

If you plan to use multiple datasets, add a few sentences about how you plan to combine these datasets.

# Setup
In this section, we imported a number of packages in order to read, edit, visualize, model, and analyze our data.
"""

import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt

#remove warnings to clean up Notebook
import warnings
warnings.filterwarnings('ignore')

"""# Data Wrangling

### Dataset #1 (Mexican Cartels Data)
"""

# loading in our data from our world in data. DataFrame contains conflict events in Mexico
df_cartels = pd.read_csv("https://data.humdata.org/dataset/79be7c54-3b7b-464a-a8b1-f99eef59cf63/resource/ebc792e7-c425-4d60-9425-3f90ebd5ac24/download/conflict_data_mex.csv")

# Remove all redundant and unnecessary data
df_cartels = df_cartels.drop(columns=['country', 'region', 'conflict_name', 'side_b_dset_id', 'side_b_new_id',
                                      'number_of_sources', 'source_date', 'where_prec', 'country_id',
                                      'where_description', 'date_prec', 'adm_2', 'source_headline',
                                      'dyad_new_id', 'source_office', 'source_original', 'where_coordinates',
                                      'relid', 'dyad_name', 'conflict_new_id', 'priogrid_gid',
                                      'conflict_dset_id', 'dyad_dset_id', 'event_clarity', 'best',
                                      'side_a_dset_id', 'side_a_new_id', 'high', 'low',
                                      'code_status', 'active_year', 'latitude', 'iso3',
                                      'longitude', 'geom_wkt', 'gwnoa', 'gwnob'])

# Define a dictionary for relabeling the columns succintly
rename_dict = {
    'id': 'id', # Unique Identifier of the event
    'year': 'year', # Year in which the conflict occurred
    'adm_1': 'place', # Mexican state where the conflict ocurred
    'type_of_violence': 'violence_type', # Nature of Conflict: 1 -> State-Based, 2-> Non-state, 3 -> One-Sided
    'source_article': 'description', # A string containing a brief description (e.g. kidnapping, murder, etc.)
    'side_a': 'initiator', # Name of the first actor, primary agressor
    'side_b': 'responder', # Name of the opposing party, the target
    'date_start': 'start_date', # Date when the conflict began
    'date_end': 'end_date', # Date when the conflict ended
    'deaths_a': 'initiator_deaths', # Number of fatalities suffered by the initiator
    'deaths_b': 'responder_deaths', # Number of Fatalities suffered by the responder
    'deaths_civilians': 'civilian_deaths', # Number of civilian Fatalities
    'deaths_unknown': 'unknown_deaths', # Number of unknown (who died?) Fatalities
}
df_cartels.rename(columns=rename_dict, inplace=True)

# (only 40 missing values out of 18,958) drop them.
df_cartels.dropna(inplace=True)

# Make all of the objects in the year column integers
def convert_year_to_int(df):
    df['year'] = df['year'].astype(int)
    return df

# Convert 'year' column to integers
df_cartels = convert_year_to_int(df_cartels)

unique_values = df_cartels['responder'].unique()
print(unique_values)

# Visualize Cleaned Data
print(df_cartels.shape)
df_cartels.head(1000)

# Summary statistics
 #print(df_cartels.describe())

# sns.histplot(df_cartels['violence_type'])
# plt.show()

# Calculate total deaths for each type
total_initiator_deaths = df_cartels['initiator_deaths'].sum()
total_responder_deaths = df_cartels['responder_deaths'].sum()
total_civilian_deaths = df_cartels['civilian_deaths'].sum()
total_unknown_deaths = df_cartels['unknown_deaths'].sum()

print("Total Initiator Deaths:", total_initiator_deaths)
print("Total Responder Deaths:", total_responder_deaths)
print("Total Civilian Deaths:", total_civilian_deaths)
print("Total Unknown Deaths:", total_unknown_deaths)

"""### Dataset #2 (Nationwide_Drugs)"""

# Nationwide Datasets
df_nation_wide19_22 = pd.read_csv("Datasets/nationwide-drugs-19_22.csv")
df_nation_wide20_23 = pd.read_csv("Datasets/nationwide-drugs-20_23.csv")
df_nation_wide21_24 = pd.read_csv("Datasets/nationwide-drugs-21-24.csv")
df_nation_wide22_25_dec = pd.read_csv("Datasets/nationwide-drugs-22-25-dec.csv")
df_nation_wide22_25_jan = pd.read_csv("Datasets/nationwide-drugs-22-25-jan.csv") #NOTE TO SELF: Need to get rid of duplicate datas
df_nation_wide22_25_nov = pd.read_csv("Datasets/nationwide-drugs-22-25-nov.csv")
df_nation_wide22_25_oct = pd.read_csv("Datasets/nationwide-drugs-22-25-oct.csv")

#Combine all Datasets
a = [df_nation_wide19_22, df_nation_wide20_23, df_nation_wide21_24, df_nation_wide22_25_dec, df_nation_wide22_25_jan, df_nation_wide22_25_nov,df_nation_wide22_25_oct]
df_combined = pd.concat(a, ignore_index=True)

#Ensure column FY are all strings and reorganized
df_combined['FY'] = df_combined['FY'].astype(str).str[:4]

#Get rid of duplicates and NaN inputs
df_combined = df_combined.drop_duplicates().dropna().reset_index(drop=True)

#Rename columns
df_combined.columns = ['Fiscal Year', 'Month', 'CBP Officer', 'Border Region', 'Land Filter',
       'Area of Responsibility', 'Drug Type', 'Count of Event',
       'Sum Qty (lbs)']

#Drop column "Land Filter" because not relevant to our question and sort by ascending "Fiscal Year"
df_combined = df_combined.drop(columns = 'Land Filter')
df_combined = df_combined.sort_values(by='Fiscal Year', ascending=True)

grouped_df_combined = df_combined.groupby(['Fiscal Year', 'Month']).sum()

df_combined.columns

df_combined

print(df_combined['FY'].unique())

print(df_combined['FY'].unique())

"""### Dataset #3 (Overdose Related Data)"""

## YOUR CODE TO LOAD/CLEAN/TIDY/WRANGLE THE DATA GOES HERE
## FEEL FREE TO ADD MULTIPLE CELLS PER SECTION

df_overdose = pd.read_csv("Datasets\Medical_Examiner_Cases_20250223.csv")
df_overdose.head()

# Convert 'Death Date' column to datetime format
df['Death Date'] = pd.to_datetime(df['Death Date'], errors='coerce')

# Fill missing values in city columns with 'Unknown'
df['Event City'].fillna('Unknown', inplace=True)
df['Death City'].fillna('Unknown', inplace=True)
df['Res City'].fillna('Unknown', inplace=True)

# Standardize 'Opioid Related' column (Ensure uniform case and remove inconsistencies)
df['Opioid Related'] = df['Opioid Related'].str.strip().str.lower()

# Check unique values in 'Opioid Related' column
opioid_values = df['Opioid Related'].unique()

# Display cleaned data summary
df.info(), opioid_values

"""# Ethics & Privacy

- The ethical considerations for this project, which analyzes cartel-related violence and terrorist attacks, prioritize data privacy, fairness, and transparency throughout the research process. One significant concern is the potential underreporting or inaccurate reporting in regions heavily influenced by cartels, which could result in biased datasets that do not fully represent the scale of cartel violence. To mitigate this, we will cross-check the data using multiple sources, including alternative datasets like hospital records, to verify accuracy. We will also pay close attention to potential regional or socio-economic biases that may affect the completeness and fairness of the data, ensuring our analysis reflects a broad and representative view of the issue.
- Alongside addressing data biases, privacy concerns are also critical. Given the sensitive nature of homicide, kidnapping, robbery data, and terrorist attacks, there's a risk of inadvertently violating the privacy of individuals, especially victims and their families. To minimize this risk, we will rely on publicly available data from official government reports, which reduces the need for personally identifiable information (PII) and negates the need for informed consent. Transparency is another key ethical principle, and we will ensure the limitations of the data and the findings are clearly communicated, acknowledging uncertainties in the analysis to avoid overstating the scope or impact of cartel activities. This approach will help us maintain ethical standards while conducting the research responsibly.

# Team Expectations

Team Organization:
- Our main method for collaborating  will be using the liveshare extension in VSCode, this way, we will be able to collaboratively modify the jupyter notebook by using the jupyter notebook extension from VSCode.
- Our main communication outlet is through discord, where we will ask questions, set deadlines, send meeting notes, and discuss plans to meet. Our meetings are both virtual and in person.
- We will meet twice a week virtually, once for structure of the assignment and once to review our assignments before turning them in
- Our group’s tone will remain casual throughout the quarter. We will ask honest questions and respond with honest answers.
- As for decision-making, we will make sure to delegate with the whole group and come to a consensus. If a group member is non-responsive, we’ve agreed to make decisions based on who is available, and inform the person who was absent of the decisions we’ve made. Overall, everything is decided within a group.
- We plan to meet 2-3 days before an assignment deadline in order for us to have time to work on and review the assignment before turning it in.
- We have made it clear that having consistent communication about what our roles in task completion is. If someone does more work than someone else, we will delegate them less tasks on the next assignment, so the workload is balanced out. If we have questions or are stuck on the assignment, we will reach out with questions and possibly be assigned a different tasks that is more doable.
- We have these rules, structures, and plans listed in our discord server.

# Project Timeline Proposal

### Project Timeline

| Assignment          | Meeting Date | Group Members | Notes                                                                 |
|---------------------|--------------|---------------|-----------------------------------------------------------------------|
| Project Proposal    | 02/09/2025   | ALL           |                                                                       |
| D5                  | 02/11/2025   | ALL           | Meet virtually to go over assignment details & delegate tasks         |
| Checkpoint #1: Data | 02/18/2025   | ALL           | Discuss assignment details and make project details concise & descriptive. Assign roles for each category. |
| Checkpoint #1: Data & D6 | 02/22/2025 | ALL       | Review and submit edited project outline as well as discussion assignment. |
| D7                  | 03/01/2025   | ALL           | Meet and delegate roles for D7 assignment.                            |
| Checkpoint #2: EDA & D8 | 03/01/2025 | ALL       | Specify where in our data we can see relationships, outliers, etc. Discuss D8 and delegate tasks for assignment. |
| Checkpoint #2: EDA & D8 | 03/08/2025 | ALL       | Review our data analysis and have somewhat of an idea of what our visualizations will look like. Submit D8. |
| Final Project + Video | 03/11/2025 | ALL         | Assign categories in the project for each of us to clean and ensure it is organized/legible. Assign speaking roles for video and evenly split report sections. |
| Final Project + Video | 03/13/2025 | ALL         | Progress update, suggestions, feedback, etc.                          |
| Final Project + Video | 03/15/2025 | ALL         | Progress update, suggestions, feedback, etc.                          |
"""